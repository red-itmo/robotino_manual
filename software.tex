\chapter{Программное обеспечение робота}
\section{Общие сведения}
Данный документ описывает взаимодействие с роботом при помощи программ на языках C/C++, системы ROS и с использованием ПК под управлением Linux Ubuntu.
Однако работать с ним можно, применяя для этого другие языки программирования и иное ПО~\cite{wiki_openrobotino}.



\section{Стандартное API}
\subsection{Общие замечания}
Стандартное ПО Robotino, основанное на языке C++, для общения управляющих программ с роботом использует протоколы TCP и UDP.
По этой причине запуск самих программ возможен как на самом роботе, так и на на любом другом компьютере, подключенном к той же, что и робот сети.



\subsection{Установка необходимого ПО}\label{part_robotinoapi2_installation}
Для работы с данным ПО в первую очередь необходимо установить на тот компьютер, на котором будут запускаться управляющие программы, библиотеку RobotinoAPI2.
Если программы будут создаваться и запускаться непосредственно на самом роботе (что не очень удобно), то устанавливать ее не нужно: она уже есть на нем.

Эта библиотека может быть скачана в бинарном виде с официального сайта (см. раздел API2 в~\cite{downloads_page}%
\footnote{Стоит обратить внимание, что на странице, соответствующей установке библиотеки RobotinoAPI2 на Linux, приведены команды только для добавления в систему сведений о содержащем ее репозитории. Для установки же самой библиотеки сразу после выполнения этих команд необходимо выполнить еще две:\\
\hspace*{\parindent}\texttt{\$ sudo apt-get update}\\
\hspace*{\parindent}\texttt{\$ sudo apt-get install robotino-api2}
}),
либо в соответствии с этими командами\footnote{После выполнения шестой из этих команд в терминал может быть выведена ошибка, говорящая о том, что версия CMake, установленная на вашем компьютере, ниже, чем 3.0. В~этом случае попробуйте закомментировать строчку \texttt{cmake\_minimum\_required(VERSION 3.0)} в файле \texttt{CMakeLists.txt} из директории \texttt{ANY\_DIR/source/api2} и повторить команду.} (где \texttt{ANY\_DIR}~--- любая папка)
\begin{lstlisting}[style=bash_commands]
$ cd ANY_DIR
$ svn export svn://svn.rec.de/openrobotino/api2/trunk source/api2
$ find source/api2/external -wholename "*/bin/*" -exec chmod +x {} \;
$ mkdir -p build/api2
$ cd build/api2
$ cmake ../../source/api2
$ make install
$ ./create_packages.sh
$ sudo dpkg -i robotino-api*.deb
\end{lstlisting}
собрана на компьютере из исходников.
Обратите внимание, данный перечень команд несколько отличается от указанного в~\cite{api2_source_build}.



\subsection{Создание программ}
Создание программ для Robotino с помощью библиотеки RobotinoAPI2 не имеет в себе ничего особенного.
Единственное, что стоит сделать для их правильной компиляции~--- это указать компилятору на расположение этой библиотеки и относящихся к ней  заголовочных файлов.
Например, данное требование при использовании компилятора gcc в Linux будет выполнено применением для компиляции программ такой последовательности команд:
\begin{lstlisting}[style=bash_commands]
$ g++ -I/usr/local/robotino/api2/include/rec/robotino/api2 -c path_to_file\
  /file_name.cpp -o path_to_obj_file/obj_name.o
$ g++ path_to_obj_file/obj_name.o /usr/local/robotino/api2/lib\
  /librec_robotino_api2.so -o path_to_bin_file/bin_name
\end{lstlisting}
а при использовании IDE CodeBlocks в Linux~--- настройками проекта в данной среде, показанными в приложении~\ref{app_codeblocks_settings}.

Относительно состава программ и компонентов библиотеки достаточно будет отметить всего две вещи.
Во-первых, в каждой из программ должен присутствовать как минимум один объект класса Com или объект класса, являющегося потомком Com, потому что именно через него осуществляется связь с роботом.
Во-вторых, некоторое подобие механизма прерывания, когда, например, при обновлении показания какого-нибудь датчика выполняется некоторая желаемая последовательность действий, реализовано в библиотеке с помощью виртуальных функций.
Следовательно, для его использования должны применяться собственные классы, являющиеся потомками библиотечных классов различных устройств робота.

Описание API доступно в~\cite{api2_documentation} и непосредственно в комментариях заголовочных файлов библиотеки.
Расположение последних скорее всего будет следующим: \verb|/usr/local/robotino/| \verb|api2/include/rec/robotino/api2/|

Примеры программ доступны в~\cite{robotino_examples}.



\section{Управление роботом средствами ROS}
\subsection{Общие замечания}
Для управления Robotino существуют определенные пакеты в ROS.
При этом стоит отметить, что сама система запускается на стороннем компьютере, а не на бортовой машине самого робота.
Последняя достаточно слаба, для того чтобы успешно справиться с этой задачей.

Упомянутые пакеты основаны на библиотеке RobotinoAPI2.
По этой причине прежде их сборки последняя должна быть установлена на компьютер (см.~подраздел~\ref{part_robotinoapi2_installation} по поводу того, как сделать это).


\subsection{Установка и использование пакетов}
Порядок установки и использования пакетов описан в материалах относящегося к ним репозитория~\cite{robotino}.
Последний содержит немного переработанные их официальные версии, хранящиеся на официальном сервере~\cite{official_packages}.
